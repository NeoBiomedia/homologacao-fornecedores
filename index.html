<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Ficha de Homologação de Fornecedores</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
  body { font-family: Arial, sans-serif; background:#fff; margin: 40px; }
  .container { max-width: 800px; margin:auto; }
  .logo { display:block; margin:0 auto; width:3cm; height:3cm; object-fit:contain; }
  h1,h2 { text-align:center; margin:0; }
  h1 { font-size:20px; margin-top:10px; font-weight:700; }
  h2 { font-size:16px; margin-bottom:30px; font-weight:700; }
  label { font-weight:bold; }
  input, textarea, select { width:100%; padding:6px; margin-bottom:15px; box-sizing:border-box; }
  button { padding:10px 15px; margin:5px; cursor:pointer; }
  .hint { font-size:12px; color:#555; margin-top:-10px; margin-bottom:15px; }
  hr { margin:25px 0; }
</style>
</head>

<body>
<div class="container">

  <img id="logoImg" class="logo" alt="Neo Biomedia" />

  <h1>NEO BIOMEDIA AVÍCOLA S.A</h1>
  <h2>FICHA DE HOMOLOGAÇÃO DE FORNECEDORES</h2>

  <form id="formHomologacao">

    <label>Razão Social:</label>
    <input type="text" id="razao" required>

    <label>CNPJ:</label>
    <input type="text" id="cnpj" required placeholder="00.000.000/0000-00">
    <div class="hint">Pode colar com ou sem máscara.</div>

    <label>Responsável Técnico:</label>
    <input type="text" id="responsavel">

    <label>Email do Fornecedor (para rastreabilidade):</label>
    <input type="email" id="emailFornecedor" required>

    <label>Telefone:</label>
    <input type="text" id="telefone">

    <label>Possui Registro no MAPA?</label>
    <select id="mapa">
      <option>Sim</option>
      <option>Não</option>
    </select>

    <label>Possui Licença Sanitária Vigente?</label>
    <select id="sanitaria">
      <option>Sim</option>
      <option>Não</option>
    </select>

    <label>Certificação ISO 9001?</label>
    <select id="iso">
      <option>Sim</option>
      <option>Não</option>
    </select>

    <label>Capacidade Produtiva Mensal:</label>
    <input type="text" id="capacidade">

    <label>Lead Time Médio (dias):</label>
    <input type="number" id="leadtime">

    <label>Observações:</label>
    <textarea id="obs" placeholder="Escreva livremente. Se for longo, o PDF vai quebrar páginas automaticamente."></textarea>

    <hr>

    <h3>DOCUMENTAÇÃO OBRIGATÓRIA PARA ENVIO</h3>

    <p>Para conclusão do processo de homologação, deverão ser anexados ao e-mail os seguintes documentos digitalizados:</p>
    <ul id="listaDocs">
      <li>Cartão CNPJ atualizado</li>
      <li>Contrato Social consolidado</li>
      <li>Certidões negativas (Federal, Estadual e FGTS)</li>
      <li>Licença Sanitária vigente</li>
      <li>Registro do produto no MAPA (quando aplicável)</li>
      <li>FISPQ atualizada</li>
      <li>Ficha Técnica do produto</li>
      <li>Certificado ISO 9001 (se aplicável)</li>
      <li>Comprovante de Responsável Técnico</li>
      <li>Procedimento de rastreabilidade ou BPF</li>
    </ul>

    <label>
      <input type="checkbox" id="declaracao" required>
      Declaro que todos os documentos acima serão anexados ao e-mail juntamente com esta ficha.
    </label>

    <br><br>

    <label>Data de Preenchimento:</label>
    <input type="text" id="dataPreenchimento" readonly>

    <label>Assinatura Digital (Nome Completo do Responsável):</label>
    <input type="text" id="assinatura" required>

    <br>

    <button type="button" onclick="gerarPDF()">Gerar PDF</button>
    <button type="button" onclick="enviarEmail()">Gerar PDF e Abrir Email</button>

  </form>
</div>

<script>
  // ✅ Logo embutido (o seu mesmo). Não depende de arquivo externo.
  const LOGO_DATA_URI = "data:image/jpeg;base64,{{SUBSTITUIDO_PELO_SEU_BASE64_NO_GITHUB_ANTERIOR}}";

  // Se você já tinha o base64 no arquivo antigo (que eu te gerei), mantenha.
  // Se por acaso ele sumiu, me avisa que eu te mando o base64 novamente.
  document.getElementById("logoImg").src = LOGO_DATA_URI;

  document.getElementById("dataPreenchimento").value =
    new Date().toLocaleDateString('pt-BR');

  function getDocsList() {
    // Pega os <li> da lista na página para refletir no PDF
    const lis = Array.from(document.querySelectorAll("#listaDocs li"));
    return lis.map(li => (li.textContent || "").trim()).filter(Boolean);
  }

  function gerarPDF() {
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF({ unit: "mm", format: "a4" });

    // Medidas A4 em mm
    const pageW = 210;
    const pageH = 297;

    const margin = 15;
    const headerH = 22;   // altura reservada pro cabeçalho
    const footerH = 12;   // altura reservada pro rodapé
    const usableW = pageW - margin * 2;

    const lineH = 5.2;    // altura de linha para texto normal

    let y = margin + headerH;

    // --- Helpers de layout ---
    function drawHeader() {
      // Logo à esquerda
      try {
        doc.addImage(LOGO_DATA_URI, "JPEG", margin, 10, 18, 18);
      } catch(e) {}

      // Empresa e título (negrito e maior)
      doc.setFont("helvetica", "bold");
      doc.setFontSize(13);
      doc.text("NEO BIOMEDIA AVÍCOLA S.A", margin + 22, 16);

      doc.setFontSize(11);
      doc.text("FICHA DE HOMOLOGAÇÃO DE FORNECEDORES", margin + 22, 22);

      // Linha separadora
      doc.setDrawColor(180);
      doc.line(margin, margin + headerH, pageW - margin, margin + headerH);
    }

    function drawFooter(pageNum, totalPages) {
      // Linha separadora
      doc.setDrawColor(200);
      doc.line(margin, pageH - footerH - 2, pageW - margin, pageH - footerH - 2);

      // Página X de Y
      doc.setFont("helvetica", "normal");
      doc.setFontSize(9);
      doc.setTextColor(80);
      doc.text(`Página ${pageNum} de ${totalPages}`, margin, pageH - 6);

      // Marca d'água leve no canto direito (rodapé)
      doc.setFont("helvetica", "bold");
      doc.setFontSize(10);
      doc.setTextColor(200); // bem clarinho
      doc.text("NEO BIOMEDIA", pageW - margin, pageH - 6, { align: "right" });

      // Reset cor
      doc.setTextColor(0);
    }

    function newPage() {
      doc.addPage();
      drawHeader();
      y = margin + headerH + 6;
    }

    function ensureSpace(linesCount = 1) {
      const needed = linesCount * lineH;
      const limit = pageH - footerH - margin;
      if (y + needed > limit) newPage();
    }

    function addSectionTitle(text) {
      ensureSpace(2);
      doc.setFont("helvetica", "bold");
      doc.setFontSize(11);
      doc.text(text, margin, y);
      y += lineH + 1;
      doc.setFont("helvetica", "normal");
      doc.setFontSize(10);
    }

    function addKeyValue(label, value) {
      const v = (value ?? "").toString().trim();
      const text = `${label}: ${v}`;
      const lines = doc.splitTextToSize(text, usableW);
      ensureSpace(lines.length);
      doc.setFont("helvetica", "normal");
      doc.setFontSize(10);
      doc.text(lines, margin, y);
      y += lines.length * lineH;
    }

    function addParagraph(text) {
      const t = (text ?? "").toString();
      const lines = doc.splitTextToSize(t, usableW);
      ensureSpace(lines.length);
      doc.setFont("helvetica", "normal");
      doc.setFontSize(10);
      doc.text(lines, margin, y);
      y += lines.length * lineH;
    }

    function addBulletList(items) {
      doc.setFont("helvetica", "normal");
      doc.setFontSize(10);
      const bulletIndent = 4;
      const textIndent = 7;

      items.forEach(item => {
        const lines = doc.splitTextToSize(item, usableW - textIndent);
        ensureSpace(lines.length + 1);

        doc.text("•", margin + bulletIndent, y);
        doc.text(lines, margin + textIndent, y);
        y += lines.length * lineH;
      });
    }

    // --- Conteúdo ---
    drawHeader();
    y = margin + headerH + 6;

    addSectionTitle("DADOS DO FORNECEDOR");
    addKeyValue("Razão Social", document.getElementById("razao").value);
    addKeyValue("CNPJ", document.getElementById("cnpj").value);
    addKeyValue("Responsável Técnico", document.getElementById("responsavel").value);
    addKeyValue("Email do Fornecedor", document.getElementById("emailFornecedor").value);
    addKeyValue("Telefone", document.getElementById("telefone").value);
    addKeyValue("Possui Registro no MAPA", document.getElementById("mapa").value);
    addKeyValue("Possui Licença Sanitária Vigente", document.getElementById("sanitaria").value);
    addKeyValue("Certificação ISO 9001", document.getElementById("iso").value);
    addKeyValue("Capacidade Produtiva Mensal", document.getElementById("capacidade").value);
    addKeyValue("Lead Time Médio (dias)", document.getElementById("leadtime").value);

    addSectionTitle("OBSERVAÇÕES");
    const obs = document.getElementById("obs").value || "";
    addParagraph(obs.length ? obs : "—");

    addSectionTitle("DOCUMENTAÇÃO OBRIGATÓRIA PARA ENVIO");
    addParagraph("Para conclusão do processo de homologação, deverão ser anexados ao e-mail os seguintes documentos digitalizados:");
    addBulletList(getDocsList());

    addSectionTitle("DECLARAÇÃO E ASSINATURA");
    addKeyValue("Declaração de envio dos documentos", document.getElementById("declaracao").checked ? "Sim" : "Não");
    addKeyValue("Data de Preenchimento", document.getElementById("dataPreenchimento").value);
    addKeyValue("Assinatura Digital (Nome Completo)", document.getElementById("assinatura").value);

    // --- Rodapé em TODAS as páginas (com paginação) ---
    const totalPages = doc.getNumberOfPages();
    for (let i = 1; i <= totalPages; i++) {
      doc.setPage(i);
      drawFooter(i, totalPages);
    }

    doc.save("Ficha_Homologacao_NeoBiomedia.pdf");
  }

  function enviarEmail() {
    gerarPDF();

    const assunto = "Ficha de Homologação - Neo Biomedia Avícola S.A";
    const corpo =
`Prezados,

Segue Ficha de Homologação preenchida.
Conforme checklist, os documentos obrigatórios seguem anexados a este e-mail.

Atenciosamente.`;

    window.location.href =
      "mailto:compras@neobiomedia.com;daniela.ricci@neobiomedia.com;liliane.bovo@neobiomedia.com"
      + "?subject=" + encodeURIComponent(assunto)
      + "&body=" + encodeURIComponent(corpo);
  }
</script>

</body>
</html>
